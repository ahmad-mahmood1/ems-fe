import { NextResponse } from "next/server";
import { WorkSheet, read, utils } from "xlsx";

let employeesList: any = [
  {
    serial_number: "SR #",
    code: "CODE",
    name: "NAME",
    father_name: "F. NAME",
    address: "ADDRESS",
    designation: "DESIGNATION",
    cnic: "CNIC #",
    doj: "DOJ",
    dol: "DOL",
    department: "Department",
    joining_salary: "Joining Salary for Personnel File",
    "2022-2023": "2022-2023",
  },
  {
    serial_number: 1,
    code: "A00002",
    name: "MAZHAR ABBASS",
    father_name: "SHER MUHAMMAD",
    address: "Obhal Khai Kalah Dakh khana Khas Tehsil Nor Pur District Khushab",
    designation: "MANAGER ADMIN",
    cnic: "38202-1263791-3",
    doj: "2014-12-31T19:00:00.000Z",
    department: "ADMIN",
    joining_salary: 20000,
    "2022-2023": 32500,
  },
  {
    serial_number: 2,
    code: "A00005",
    name: "OAN KHAN",
    father_name: "MEHMOOD KHAN",
    address: "Tehlah Khatwan Dakh khana Khas Tehsil Nor pur District Khushab",
    designation: "HELPER",
    cnic: "38202-8935147-5",
    doj: "2014-12-31T19:00:00.000Z",
    department: "JOINING SECTION",
    joining_salary: 17000,
    "2022-2023": 25000,
  },
  {
    serial_number: 3,
    code: "A00010",
    name: "FAQIR HUSSAIN",
    father_name: "MUHAMMAD HUSSAIN",
    address: "Kamahan Dak khana Khas Lahore Cantt",
    designation: "MACHINE OPERATOR",
    cnic: "36104-2514624-1",
    doj: "2017-01-01T19:00:00.000Z",
    department: "DYEING SECTION",
    joining_salary: 17500,
    "2022-2023": 28000,
  },
  {
    serial_number: 4,
    code: "A00023",
    name: "MUHAMMAD YOUNIS",
    father_name: "ATTA MUHAMMAD",
    address: "Laal Husaain Dakh Khana Watto Tehsil Nor pur District Khushab",
    designation: "DRIVER",
    cnic: "38202-1288066-3",
    doj: "2014-12-31T19:00:00.000Z",
    department: "DRIVER",
    joining_salary: 17500,
    "2022-2023": 27583,
  },
  {
    serial_number: 5,
    code: "A00025",
    name: "ABDUL REHMAN",
    father_name: "ASHIQ ALI",
    address: "Chak # 577 Jarnail Wala Warbarton Nankana Sahib",
    designation: "MACHINE OPERATOR",
    cnic: "35501-0961905-7",
    doj: "2023-01-03T19:00:00.000Z",
    department: "DYEING SECTION",
    joining_salary: 27583,
    "2022-2023": 27583,
  },
  {
    serial_number: 6,
    code: "A00027",
    name: "AQEEL HAIDER",
    father_name: "MUHAMMAD YAR",
    address: "Dakh Khana Kot Aisah Shah, Jhok Usman Jhang",
    designation: "HELPER",
    cnic: "33202-9463439-5",
    doj: "2015-03-31T19:00:00.000Z",
    department: "CORRUGATION",
    joining_salary: 17000,
    "2022-2023": 25000,
  },
  {
    serial_number: 7,
    code: "A00028",
    name: "MUHAMMAD ISHAQ",
    father_name: "RIAZ HUSSAIN",
    address: "Dakh Khana Khas Tehsil Shuja Abad District Multan",
    designation: "OPERATOR",
    cnic: "36304-0784731-9",
    doj: "2023-01-02T19:00:00.000Z",
    department: "CORRUGATION",
    joining_salary: 27590,
    "2022-2023": 27590,
  },
  {
    serial_number: 8,
    code: "A00041",
    name: "HAROON",
    father_name: "DAWOOD MASIH",
    address: "Kareem Park 17 Ferozpur Road Lahore Cantt",
    designation: "JOINING MAN",
    cnic: "35201-7061132-3",
    doj: "2015-12-31T19:00:00.000Z",
    department: "JOINING SECTION",
    joining_salary: 18500,
    "2022-2023": 29000,
  },
  {
    serial_number: 9,
    code: "A00046",
    name: "ABDUL REHMAN",
    father_name: "MUHAMMAD SHAFIH",
    address: "Hosue No 165-D Block Taj Pura Lahore",
    designation: "MACHINE OPERATOR",
    cnic: "35201-5265697-5",
    doj: "2023-01-02T19:00:00.000Z",
    department: "DYEING SECTION",
    joining_salary: 27583,
    "2022-2023": 27583,
  },
  {
    serial_number: 10,
    code: "A00047",
    name: "SHAHBAZ ALI ",
    father_name: "REHMAT ALI",
    address: "Kamahan Tehsil Lahore Cantt, Zilla Lahore",
    designation: "MACHINE OPERATOR",
    cnic: "35201-7838139-5",
    doj: "2016-05-21T19:00:00.000Z",
    department: "PASTING",
    joining_salary: 18000,
    "2022-2023": 28550,
  },
  {
    serial_number: 11,
    code: "A00048",
    name: "HASSAN REHMAN",
    father_name: "ABDUL REHMAN",
    address: "Hosue No 165-D Block Taj Pura Lahore",
    designation: "HELPER",
    cnic: "35201-3790182-5",
    doj: "2023-01-02T19:00:00.000Z",
    department: "JOINING SECTION",
    joining_salary: 25000,
    "2022-2023": 25000,
  },
  {
    serial_number: 12,
    code: "A00050",
    name: "ABDUL GHAFAR",
    father_name: "MUHAMMAD YOUNIS",
    address: "Dakh Khana Khas Tehsil Shakar Garh District Narowal",
    designation: "SECURITY GUARD",
    cnic: "35402-0192673-5",
    doj: "2017-12-31T19:00:00.000Z",
    department: "GUARD",
    joining_salary: 18900,
    "2022-2023": 25911,
  },
  {
    serial_number: 13,
    code: "A00051",
    name: "MUKHTAR MASIH",
    father_name: "YOUNIS MASIH",
    address: "House # 226 Muhalla Mariyam Colony Green Town Lahore",
    designation: "MACHINE OPERATOR",
    cnic: "35202-4059493-7",
    doj: "2018-01-09T19:00:00.000Z",
    department: "DYEING SECTION",
    joining_salary: 18800,
    "2022-2023": 27583,
  },
  {
    serial_number: 14,
    code: "A00009",
    name: "MUHAMMAD ABBASS",
    father_name: "MUHAMMAD BASHIR",
    address: "Kachi Abadi Kamahan Dakh Khana Khas Lahore Cantt",
    designation: "MACHINE OPERATOR",
    cnic: "35201-5133796-9",
    doj: "2017-01-01T19:00:00.000Z",
    dol: "2022-06-30T19:00:00.000Z",
    department: "PASTING",
    joining_salary: 17500,
    "2022-2023": 27500,
  },
  {
    serial_number: 15,
    code: "A00017",
    name: "JAVED IQBAL",
    father_name: "BASHIR AHMED",
    address: "Chak # 58 G D  Dakh Khana Khas District Sahiwal",
    designation: "MACHINE OPERATOR",
    cnic: "36502-8952517-9",
    doj: "2017-01-08T19:00:00.000Z",
    dol: "2022-05-31T19:00:00.000Z",
    department: "CUTTING",
    joining_salary: 17500,
    "2022-2023": 24000,
  },
];
export async function GET(req: Request) {
  let fetchEmployeesDummy = () =>
    new Promise((r) => setTimeout(() => r(employeesList), 100));

  let employees = await fetchEmployeesDummy();

  return NextResponse.json({ employees }, { status: 200 });
}

export async function POST(req: Request) {
  const data = await req.arrayBuffer();
  const wb = read(data, { cellDates: true });
  const ws = wb.Sheets[wb.SheetNames[0] as string] as WorkSheet;
  const worksheetToJson: object[] = utils.sheet_to_json(ws, {
    header: [
      "serial_number",
      "code",
      "name",
      "father_name",
      "address",
      "designation",
      "cnic",
      "doj",
      "dol",
      "department",
      "joining_salary",
      "2022-2023",
    ],
    range: 1,
  }); // generate objects

  employeesList = worksheetToJson.slice(0, worksheetToJson.length - 1);

  return NextResponse.json({ employees: worksheetToJson }, { status: 200 });
}
